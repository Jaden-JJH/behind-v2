{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "b64c7fdf-7c4b-4865-90b5-ce70792c02bd",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Requirement already satisfied: python-dotenv in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (1.1.1)\n",
      "Collecting supabase\n",
      "  Downloading supabase-2.27.2-py3-none-any.whl.metadata (4.6 kB)\n",
      "Requirement already satisfied: psycopg2-binary in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (2.9.11)\n",
      "Collecting google-generativeai\n",
      "  Using cached google_generativeai-0.8.6-py3-none-any.whl.metadata (3.9 kB)\n",
      "Collecting realtime==2.27.2 (from supabase)\n",
      "  Downloading realtime-2.27.2-py3-none-any.whl.metadata (7.0 kB)\n",
      "Collecting supabase-functions==2.27.2 (from supabase)\n",
      "  Downloading supabase_functions-2.27.2-py3-none-any.whl.metadata (2.4 kB)\n",
      "Collecting storage3==2.27.2 (from supabase)\n",
      "  Downloading storage3-2.27.2-py3-none-any.whl.metadata (2.1 kB)\n",
      "Collecting supabase-auth==2.27.2 (from supabase)\n",
      "  Downloading supabase_auth-2.27.2-py3-none-any.whl.metadata (6.4 kB)\n",
      "Collecting postgrest==2.27.2 (from supabase)\n",
      "  Downloading postgrest-2.27.2-py3-none-any.whl.metadata (3.4 kB)\n",
      "Requirement already satisfied: httpx<0.29,>=0.26 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from supabase) (0.28.1)\n",
      "Collecting yarl>=1.22.0 (from supabase)\n",
      "  Downloading yarl-1.22.0-cp311-cp311-macosx_11_0_arm64.whl.metadata (75 kB)\n",
      "Collecting deprecation>=2.1.0 (from postgrest==2.27.2->supabase)\n",
      "  Using cached deprecation-2.1.0-py2.py3-none-any.whl.metadata (4.6 kB)\n",
      "Requirement already satisfied: pydantic<3.0,>=1.9 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from postgrest==2.27.2->supabase) (2.11.7)\n",
      "Requirement already satisfied: typing-extensions>=4.14.0 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from realtime==2.27.2->supabase) (4.14.0)\n",
      "Requirement already satisfied: websockets<16,>=11 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from realtime==2.27.2->supabase) (15.0.1)\n",
      "Collecting pyiceberg>=0.10.0 (from storage3==2.27.2->supabase)\n",
      "  Downloading pyiceberg-0.10.0-cp311-cp311-macosx_11_0_arm64.whl.metadata (4.9 kB)\n",
      "Collecting pyjwt>=2.10.1 (from pyjwt[crypto]>=2.10.1->supabase-auth==2.27.2->supabase)\n",
      "  Using cached PyJWT-2.10.1-py3-none-any.whl.metadata (4.0 kB)\n",
      "Collecting strenum>=0.4.15 (from supabase-functions==2.27.2->supabase)\n",
      "  Using cached StrEnum-0.4.15-py3-none-any.whl.metadata (5.3 kB)\n",
      "Requirement already satisfied: anyio in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from httpx<0.29,>=0.26->supabase) (4.9.0)\n",
      "Requirement already satisfied: certifi in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from httpx<0.29,>=0.26->supabase) (2024.2.2)\n",
      "Requirement already satisfied: httpcore==1.* in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from httpx<0.29,>=0.26->supabase) (1.0.5)\n",
      "Requirement already satisfied: idna in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from httpx<0.29,>=0.26->supabase) (2.10)\n",
      "Requirement already satisfied: h11<0.15,>=0.13 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from httpcore==1.*->httpx<0.29,>=0.26->supabase) (0.14.0)\n",
      "Collecting h2<5,>=3 (from httpx[http2]<0.29,>=0.26->postgrest==2.27.2->supabase)\n",
      "  Using cached h2-4.3.0-py3-none-any.whl.metadata (5.1 kB)\n",
      "Collecting hyperframe<7,>=6.1 (from h2<5,>=3->httpx[http2]<0.29,>=0.26->postgrest==2.27.2->supabase)\n",
      "  Using cached hyperframe-6.1.0-py3-none-any.whl.metadata (4.3 kB)\n",
      "Collecting hpack<5,>=4.1 (from h2<5,>=3->httpx[http2]<0.29,>=0.26->postgrest==2.27.2->supabase)\n",
      "  Using cached hpack-4.1.0-py3-none-any.whl.metadata (4.6 kB)\n",
      "Requirement already satisfied: annotated-types>=0.6.0 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from pydantic<3.0,>=1.9->postgrest==2.27.2->supabase) (0.6.0)\n",
      "Requirement already satisfied: pydantic-core==2.33.2 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from pydantic<3.0,>=1.9->postgrest==2.27.2->supabase) (2.33.2)\n",
      "Requirement already satisfied: typing-inspection>=0.4.0 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from pydantic<3.0,>=1.9->postgrest==2.27.2->supabase) (0.4.1)\n",
      "Collecting google-ai-generativelanguage==0.6.15 (from google-generativeai)\n",
      "  Using cached google_ai_generativelanguage-0.6.15-py3-none-any.whl.metadata (5.7 kB)\n",
      "Requirement already satisfied: google-api-core in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from google-generativeai) (2.19.1)\n",
      "Requirement already satisfied: google-api-python-client in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from google-generativeai) (2.154.0)\n",
      "Requirement already satisfied: google-auth>=2.15.0 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from google-generativeai) (2.31.0)\n",
      "Requirement already satisfied: protobuf in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from google-generativeai) (5.29.5)\n",
      "Requirement already satisfied: tqdm in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from google-generativeai) (4.66.2)\n",
      "Requirement already satisfied: proto-plus<2.0.0dev,>=1.22.3 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from google-ai-generativelanguage==0.6.15->google-generativeai) (1.24.0)\n",
      "Requirement already satisfied: googleapis-common-protos<2.0.dev0,>=1.56.2 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from google-api-core->google-generativeai) (1.63.2)\n",
      "Requirement already satisfied: requests<3.0.0.dev0,>=2.18.0 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from google-api-core->google-generativeai) (2.31.0)\n",
      "Requirement already satisfied: grpcio<2.0dev,>=1.33.2 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-ai-generativelanguage==0.6.15->google-generativeai) (1.64.1)\n",
      "Requirement already satisfied: grpcio-status<2.0.dev0,>=1.33.2 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-ai-generativelanguage==0.6.15->google-generativeai) (1.62.2)\n",
      "Requirement already satisfied: cachetools<6.0,>=2.0.0 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from google-auth>=2.15.0->google-generativeai) (5.3.3)\n",
      "Requirement already satisfied: pyasn1-modules>=0.2.1 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from google-auth>=2.15.0->google-generativeai) (0.4.0)\n",
      "Requirement already satisfied: rsa<5,>=3.1.4 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from google-auth>=2.15.0->google-generativeai) (4.9)\n",
      "Requirement already satisfied: charset-normalizer<4,>=2 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from requests<3.0.0.dev0,>=2.18.0->google-api-core->google-generativeai) (3.3.2)\n",
      "Requirement already satisfied: urllib3<3,>=1.21.1 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from requests<3.0.0.dev0,>=2.18.0->google-api-core->google-generativeai) (2.2.1)\n",
      "Requirement already satisfied: pyasn1>=0.1.3 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from rsa<5,>=3.1.4->google-auth>=2.15.0->google-generativeai) (0.6.0)\n",
      "Requirement already satisfied: packaging in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from deprecation>=2.1.0->postgrest==2.27.2->supabase) (23.2)\n",
      "Collecting cachetools<6.0,>=2.0.0 (from google-auth>=2.15.0->google-generativeai)\n",
      "  Using cached cachetools-5.5.2-py3-none-any.whl.metadata (5.4 kB)\n",
      "Requirement already satisfied: click<9.0.0,>=7.1.1 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from pyiceberg>=0.10.0->storage3==2.27.2->supabase) (8.1.7)\n",
      "Requirement already satisfied: fsspec>=2023.1.0 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from pyiceberg>=0.10.0->storage3==2.27.2->supabase) (2024.5.0)\n",
      "Requirement already satisfied: mmh3<6.0.0,>=4.0.0 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from pyiceberg>=0.10.0->storage3==2.27.2->supabase) (5.1.0)\n",
      "Requirement already satisfied: pyparsing<4.0.0,>=3.1.0 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from pyiceberg>=0.10.0->storage3==2.27.2->supabase) (3.1.2)\n",
      "Collecting pyroaring<2.0.0,>=1.0.0 (from pyiceberg>=0.10.0->storage3==2.27.2->supabase)\n",
      "  Downloading pyroaring-1.0.3-cp311-cp311-macosx_11_0_arm64.whl.metadata (10 kB)\n",
      "Requirement already satisfied: rich<15.0.0,>=10.11.0 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from pyiceberg>=0.10.0->storage3==2.27.2->supabase) (14.2.0)\n",
      "Requirement already satisfied: sortedcontainers==2.4.0 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from pyiceberg>=0.10.0->storage3==2.27.2->supabase) (2.4.0)\n",
      "Collecting strictyaml<2.0.0,>=1.7.0 (from pyiceberg>=0.10.0->storage3==2.27.2->supabase)\n",
      "  Using cached strictyaml-1.7.3-py3-none-any.whl.metadata (11 kB)\n",
      "Requirement already satisfied: tenacity<10.0.0,>=8.2.3 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from pyiceberg>=0.10.0->storage3==2.27.2->supabase) (8.2.3)\n",
      "Requirement already satisfied: markdown-it-py>=2.2.0 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from rich<15.0.0,>=10.11.0->pyiceberg>=0.10.0->storage3==2.27.2->supabase) (3.0.0)\n",
      "Requirement already satisfied: pygments<3.0.0,>=2.13.0 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from rich<15.0.0,>=10.11.0->pyiceberg>=0.10.0->storage3==2.27.2->supabase) (2.17.2)\n",
      "Requirement already satisfied: python-dateutil>=2.6.0 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from strictyaml<2.0.0,>=1.7.0->pyiceberg>=0.10.0->storage3==2.27.2->supabase) (2.9.0.post0)\n",
      "Requirement already satisfied: mdurl~=0.1 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from markdown-it-py>=2.2.0->rich<15.0.0,>=10.11.0->pyiceberg>=0.10.0->storage3==2.27.2->supabase) (0.1.2)\n",
      "Requirement already satisfied: cryptography>=3.4.0 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from pyjwt[crypto]>=2.10.1->supabase-auth==2.27.2->supabase) (44.0.0)\n",
      "Requirement already satisfied: cffi>=1.12 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from cryptography>=3.4.0->pyjwt[crypto]>=2.10.1->supabase-auth==2.27.2->supabase) (1.16.0)\n",
      "Requirement already satisfied: pycparser in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from cffi>=1.12->cryptography>=3.4.0->pyjwt[crypto]>=2.10.1->supabase-auth==2.27.2->supabase) (2.21)\n",
      "Requirement already satisfied: six>=1.5 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from python-dateutil>=2.6.0->strictyaml<2.0.0,>=1.7.0->pyiceberg>=0.10.0->storage3==2.27.2->supabase) (1.16.0)\n",
      "Requirement already satisfied: multidict>=4.0 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from yarl>=1.22.0->supabase) (6.0.5)\n",
      "Collecting propcache>=0.2.1 (from yarl>=1.22.0->supabase)\n",
      "  Downloading propcache-0.4.1-cp311-cp311-macosx_11_0_arm64.whl.metadata (13 kB)\n",
      "Requirement already satisfied: sniffio>=1.1 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from anyio->httpx<0.29,>=0.26->supabase) (1.3.1)\n",
      "Requirement already satisfied: httplib2<1.dev0,>=0.19.0 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from google-api-python-client->google-generativeai) (0.22.0)\n",
      "Requirement already satisfied: google-auth-httplib2<1.0.0,>=0.2.0 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from google-api-python-client->google-generativeai) (0.2.0)\n",
      "Requirement already satisfied: uritemplate<5,>=3.0.1 in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (from google-api-python-client->google-generativeai) (4.1.1)\n",
      "Downloading supabase-2.27.2-py3-none-any.whl (16 kB)\n",
      "Downloading postgrest-2.27.2-py3-none-any.whl (21 kB)\n",
      "Downloading realtime-2.27.2-py3-none-any.whl (22 kB)\n",
      "Downloading storage3-2.27.2-py3-none-any.whl (27 kB)\n",
      "Downloading supabase_auth-2.27.2-py3-none-any.whl (48 kB)\n",
      "Downloading supabase_functions-2.27.2-py3-none-any.whl (8.5 kB)\n",
      "Using cached h2-4.3.0-py3-none-any.whl (61 kB)\n",
      "Using cached hpack-4.1.0-py3-none-any.whl (34 kB)\n",
      "Using cached hyperframe-6.1.0-py3-none-any.whl (13 kB)\n",
      "Using cached google_generativeai-0.8.6-py3-none-any.whl (155 kB)\n",
      "Using cached google_ai_generativelanguage-0.6.15-py3-none-any.whl (1.3 MB)\n",
      "Using cached deprecation-2.1.0-py2.py3-none-any.whl (11 kB)\n",
      "Downloading pyiceberg-0.10.0-cp311-cp311-macosx_11_0_arm64.whl (587 kB)\n",
      "\u001b[2K   \u001b[90mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\u001b[0m \u001b[32m587.0/587.0 kB\u001b[0m \u001b[31m11.5 MB/s\u001b[0m  \u001b[33m0:00:00\u001b[0m\n",
      "\u001b[?25hUsing cached cachetools-5.5.2-py3-none-any.whl (10 kB)\n",
      "Downloading pyroaring-1.0.3-cp311-cp311-macosx_11_0_arm64.whl (313 kB)\n",
      "Using cached strictyaml-1.7.3-py3-none-any.whl (123 kB)\n",
      "Using cached PyJWT-2.10.1-py3-none-any.whl (22 kB)\n",
      "Using cached StrEnum-0.4.15-py3-none-any.whl (8.9 kB)\n",
      "Downloading yarl-1.22.0-cp311-cp311-macosx_11_0_arm64.whl (94 kB)\n",
      "Downloading propcache-0.4.1-cp311-cp311-macosx_11_0_arm64.whl (47 kB)\n",
      "Installing collected packages: strenum, pyroaring, pyjwt, propcache, hyperframe, hpack, deprecation, cachetools, yarl, strictyaml, h2, realtime, pyiceberg, supabase-functions, supabase-auth, storage3, postgrest, supabase, google-ai-generativelanguage, google-generativeai\n",
      "\u001b[2K  Attempting uninstall: cachetools\n",
      "\u001b[2K    Found existing installation: cachetools 5.3.3\n",
      "\u001b[2K    Uninstalling cachetools-5.3.3:\n",
      "\u001b[2K      Successfully uninstalled cachetools-5.3.3\n",
      "\u001b[2K  Attempting uninstall: yarl\n",
      "\u001b[2K    Found existing installation: yarl 1.9.4â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\u001b[0m \u001b[32m 8/20\u001b[0m [yarl]\n",
      "\u001b[2K    Uninstalling yarl-1.9.4:mâ•º\u001b[0m\u001b[90mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\u001b[0m \u001b[32m 8/20\u001b[0m [yarl]\n",
      "\u001b[2K      Successfully uninstalled yarl-1.9.4â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\u001b[0m \u001b[32m 8/20\u001b[0m [yarl]\n",
      "\u001b[2K   \u001b[90mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\u001b[0m \u001b[32m20/20\u001b[0m [google-generativeai]ogle-generativeai]language]\n",
      "\u001b[1A\u001b[2K\u001b[31mERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.\n",
      "langchain-experimental 0.3.4 requires langchain-community<0.4.0,>=0.3.0, but you have langchain-community 0.0.20 which is incompatible.\n",
      "langchain-experimental 0.3.4 requires langchain-core<0.4.0,>=0.3.28, but you have langchain-core 0.1.23 which is incompatible.\n",
      "google-cloud-resource-manager 1.12.3 requires protobuf!=3.20.0,!=3.20.1,!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,<5.0.0dev,>=3.19.5, but you have protobuf 5.29.5 which is incompatible.\n",
      "google-cloud-aiplatform 1.100.0 requires google-cloud-storage<3.0.0,>=1.32.0, but you have google-cloud-storage 3.4.0 which is incompatible.\u001b[0m\u001b[31m\n",
      "\u001b[0mSuccessfully installed cachetools-5.5.2 deprecation-2.1.0 google-ai-generativelanguage-0.6.15 google-generativeai-0.8.6 h2-4.3.0 hpack-4.1.0 hyperframe-6.1.0 postgrest-2.27.2 propcache-0.4.1 pyiceberg-0.10.0 pyjwt-2.10.1 pyroaring-1.0.3 realtime-2.27.2 storage3-2.27.2 strenum-0.4.15 strictyaml-1.7.3 supabase-2.27.2 supabase-auth-2.27.2 supabase-functions-2.27.2 yarl-1.22.0\n",
      "\n",
      "\u001b[1m[\u001b[0m\u001b[34;49mnotice\u001b[0m\u001b[1;39;49m]\u001b[0m\u001b[39;49m A new release of pip is available: \u001b[0m\u001b[31;49m25.2\u001b[0m\u001b[39;49m -> \u001b[0m\u001b[32;49m25.3\u001b[0m\n",
      "\u001b[1m[\u001b[0m\u001b[34;49mnotice\u001b[0m\u001b[1;39;49m]\u001b[0m\u001b[39;49m To update, run: \u001b[0m\u001b[32;49mpip install --upgrade pip\u001b[0m\n"
     ]
    }
   ],
   "source": [
    "!pip install python-dotenv supabase psycopg2-binary google-generativeai"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "14c50422-0956-489f-bec1-0a18397cf9ec",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Requirement already satisfied: pip in /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (25.2)\n",
      "Collecting pip\n",
      "  Using cached pip-25.3-py3-none-any.whl.metadata (4.7 kB)\n",
      "Using cached pip-25.3-py3-none-any.whl (1.8 MB)\n",
      "Installing collected packages: pip\n",
      "  Attempting uninstall: pip\n",
      "    Found existing installation: pip 25.2\n",
      "    Uninstalling pip-25.2:\n",
      "      Successfully uninstalled pip-25.2\n",
      "Successfully installed pip-25.3\n"
     ]
    }
   ],
   "source": [
    "!pip install --upgrade pip"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "ef27f494-6be0-4c5f-a428-4c8e8acda63b",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "âœ… í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ ì„±ê³µ: https://gknekrinduyp...\n",
      "ğŸš€ 20ëª… ê°€ìƒ ìœ ì € ìƒì„± ì‹œì‘...\n",
      "âœ… ìƒì„± ì™„ë£Œ: ã…‡\n",
      "âœ… ìƒì„± ì™„ë£Œ: ã…‹ã…‹ã…‹\n",
      "âœ… ìƒì„± ì™„ë£Œ: ì¤‘êµ­ê³µì‚°ë‹¹ì²™ê²°\n",
      "âœ… ìƒì„± ì™„ë£Œ: í•´ë³‘1244ê¸°\n",
      "âœ… ìƒì„± ì™„ë£Œ: ë‹¹ê·¼\n",
      "âœ… ìƒì„± ì™„ë£Œ: ì¢Œë¹¨ë°°ê¸‰ê²¬\n",
      "âœ… ìƒì„± ì™„ë£Œ: ã…‡ã…‡\n",
      "âœ… ìƒì„± ì™„ë£Œ: ê·¹ìš°ëŠ”ì§–ì–´\n",
      "âœ… ìƒì„± ì™„ë£Œ: í˜¸ê°ê³ ë‹‰ê²Œì´\n",
      "âœ… ìƒì„± ì™„ë£Œ: ã…‰ì¬ë§¤ì´\n",
      "âœ… ìƒì„± ì™„ë£Œ: ë‹‰ë„¤ì„ì—†\n",
      "âœ… ìƒì„± ì™„ë£Œ: í•œëšœê»‘ì¥´ë¦¬ë‘˜ì´\n",
      "âœ… ìƒì„± ì™„ë£Œ: ì´ê±°ë­í•˜ëŠ”ì‚¬ì´íŠ¸ì„\n",
      "âœ… ìƒì„± ì™„ë£Œ: ã…ã…ã…ã…ˆ\n",
      "âœ… ìƒì„± ì™„ë£Œ: ì´ìŠˆã…ˆí‚¤\n",
      "âœ… ìƒì„± ì™„ë£Œ: ëŒ“ê¸€ì•Œë°”\n",
      "âœ… ìƒì„± ì™„ë£Œ: êº¼ë¬´ìœ„í‚¤\n",
      "âœ… ìƒì„± ì™„ë£Œ: ã„·ã…ˆã…‚ã…‚\n",
      "âœ… ìƒì„± ì™„ë£Œ: ã…‡ã…‡ã…‡ã…‡ã…‡ã…‡\n",
      "âœ… ìƒì„± ì™„ë£Œ: í•œë‚¨ã…ˆ\n",
      "\n",
      "âœ¨ ëª¨ë“  ìœ ì € ìƒì„± ì™„ë£Œ ë° ai_personas.json ì €ì¥ë¨.\n"
     ]
    }
   ],
   "source": [
    "import os\n",
    "from dotenv import load_dotenv\n",
    "from supabase import create_client, Client\n",
    "import json\n",
    "\n",
    "# 1. í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ\n",
    "load_dotenv(dotenv_path='.env.local')\n",
    "\n",
    "url = os.getenv(\"NEXT_PUBLIC_SUPABASE_URL\")\n",
    "key = os.getenv(\"SUPABASE_SERVICE_ROLE_KEY\")\n",
    "supabase: Client = create_client(url, key)\n",
    "\n",
    "\n",
    "# ë¡œë“œ í™•ì¸ (ë³´ì•ˆì„ ìœ„í•´ ì•ë¶€ë¶„ë§Œ ì¶œë ¥)\n",
    "if not url or not key:\n",
    "    print(\"âŒ ì˜¤ë¥˜: .env.local íŒŒì¼ì—ì„œ ì •ë³´ë¥¼ ì½ì–´ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. íŒŒì¼ëª…ê³¼ ë³€ìˆ˜ëª…ì„ í™•ì¸í•´ì£¼ì„¸ìš”.\")\n",
    "else:\n",
    "    print(f\"âœ… í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ ì„±ê³µ: {url[:20]}...\")\n",
    "\n",
    "\n",
    "\n",
    "# 2. Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”\n",
    "try:\n",
    "    supabase: Client = create_client(url, key)\n",
    "except Exception as e:\n",
    "    print(f\"âŒ í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì‹¤íŒ¨: {e}\")\n",
    "\n",
    "\n",
    "\n",
    "# 2. 20ëª… í˜ë¥´ì†Œë‚˜ ë°ì´í„° ì •ì˜\n",
    "personas_to_create = [\n",
    "    {\"nick\": \"ã…‡\", \"style\": \"ë¶„ì„ì , ì¡´ëŒ“ë§\"}, {\"nick\": \"ã…‹ã…‹ã…‹\", \"style\": \"ì •ë³´ì „ë‹¬, ê³µì†í•¨\"},\n",
    "    {\"nick\": \"ì¤‘êµ­ê³µì‚°ë‹¹ì²™ê²°\", \"style\": \"ë…¼ë¦¬ì , ë”±ë”±í•¨\"}, {\"nick\": \"í•´ë³‘1244ê¸°\", \"style\": \"ì§ì„¤ì , ì§§ì€ ë°˜ë§\"},\n",
    "    {\"nick\": \"ë‹¹ê·¼\", \"style\": \"ê¸ì •ì , ì´ëª¨í‹°ì½˜\"}, {\"nick\": \"ì¢Œë¹¨ë°°ê¸‰ê²¬\", \"style\": \"ê³µê°í˜•, ë‹¤ì •í•¨\"},\n",
    "    {\"nick\": \"ã…‡ã…‡\", \"style\": \"ì—ë„ˆì§€ë„˜ì¹¨, ê°íƒ„ì‚¬\"}, {\"nick\": \"ê·¹ìš°ëŠ”ì§–ì–´\", \"style\": \"ê°ì„±ì , ë¶€ë“œëŸ¬ì›€\"},\n",
    "    {\"nick\": \"í˜¸ê°ê³ ë‹‰ê²Œì´\", \"style\": \"íšŒì˜ì , ì˜ë¬¸ë¬¸\"}, {\"nick\": \"ã…‰ì¬ë§¤ì´\", \"style\": \"ë¹„íŒì , ëƒ‰ì†Œì \"},\n",
    "    {\"nick\": \"ë‹‰ë„¤ì„ì—†\", \"style\": \"ê°„ê²°í•¨, ê¹Œì¹ í•¨\"}, {\"nick\": \"í•œëšœê»‘ì¥´ë¦¬ë‘˜ì´\", \"style\": \"ë¯¼ê°í•¨, ì§€ì ì§ˆ\"},\n",
    "    {\"nick\": \"ì´ê±°ë­í•˜ëŠ”ì‚¬ì´íŠ¸ì„\", \"style\": \"ì§ˆë¬¸í˜•\"}, {\"nick\": \"ã…ã…ã…ã…ˆ\", \"style\": \"ë‹¹í™©í•¨, ê°€ë²¼ì›€\"},\n",
    "    {\"nick\": \"ì´ìŠˆã…ˆí‚¤\", \"style\": \"ì—‰ëš±í•¨, ì§‘ìš”í•¨\"}, {\"nick\": \"ëŒ“ê¸€ì•Œë°”\", \"style\": \"ê°„ì ˆí•¨, ì¡´ëŒ“ë§\"},\n",
    "    {\"nick\": \"êº¼ë¬´ìœ„í‚¤\", \"style\": \"ë°©ê´€ì, ì§§ìŒ\"}, {\"nick\": \"ã„·ã…ˆã…‚ã…‚\", \"style\": \"í‰ë²”í•¨, ê°€ë²¼ì›€\"},\n",
    "    {\"nick\": \"ã…‡ã…‡ã…‡ã…‡ã…‡ã…‡\", \"style\": \"ë¬´ì‹¬í•¨, ì‹œí¬í•¨\"}, {\"nick\": \"í•œë‚¨ã…ˆ\", \"style\": \"ì§§ì€ ë‹µë³€, ì¿¨í•¨\"}\n",
    "]\n",
    "\n",
    "created_ai_list = []\n",
    "\n",
    "print(\"ğŸš€ 20ëª… ê°€ìƒ ìœ ì € ìƒì„± ì‹œì‘...\")\n",
    "\n",
    "for i, p in enumerate(personas_to_create):\n",
    "    email = f\"ai_bot_{i+1}@gmail.com\" # ê°€ì§œ ì´ë©”ì¼\n",
    "    try:\n",
    "        # Auth ìœ ì € ìƒì„±\n",
    "        user = supabase.auth.admin.create_user({\n",
    "            \"email\": email,\n",
    "            \"password\": \"password2026!\",\n",
    "            \"user_metadata\": {\"nickname\": p['nick']},\n",
    "            \"email_confirm\": True\n",
    "        })\n",
    "        user_id = user.user.id\n",
    "        \n",
    "        # ì •ë³´ ì €ì¥\n",
    "        created_ai_list.append({\n",
    "            \"user_id\": user_id,\n",
    "            \"nickname\": p['nick'],\n",
    "            \"persona_style\": p['style']\n",
    "        })\n",
    "        print(f\"âœ… ìƒì„± ì™„ë£Œ: {p['nick']}\")\n",
    "    except Exception as e:\n",
    "        print(f\"âŒ ì‹¤íŒ¨ ({p['nick']}): {e}\")\n",
    "\n",
    "# 3. ê²°ê³¼ë¥¼ íŒŒì¼ë¡œ ì €ì¥ (ë‚˜ì¤‘ì— ìë™í™” ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ë¡œë“œí•´ì„œ ì‚¬ìš©)\n",
    "with open(\"ai_personas.json\", \"w\", encoding=\"utf-8\") as f:\n",
    "    json.dump(created_ai_list, f, ensure_ascii=False, indent=2)\n",
    "\n",
    "print(\"\\nâœ¨ ëª¨ë“  ìœ ì € ìƒì„± ì™„ë£Œ ë° ai_personas.json ì €ì¥ë¨.\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "38329dcf-84d8-4909-95d6-f124b2fdf46c",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/var/folders/w2/cn99zpw14_xgyr6cc03bsxrm0000gn/T/ipykernel_93924/3916659485.py:2: FutureWarning: \n",
      "\n",
      "All support for the `google.generativeai` package has ended. It will no longer be receiving \n",
      "updates or bug fixes. Please switch to the `google.genai` package as soon as possible.\n",
      "See README for more details:\n",
      "\n",
      "https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md\n",
      "\n",
      "  import google.generativeai as genai\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "AI ì‘ë‹µ: ì¿¨í•˜ê²Œ í•œë§ˆë””ë¡œ ë°”ê¿”ë‹¬ë¼ê³  í•˜ì…¨ìœ¼ë‹ˆ, ëª‡ ê°€ì§€ ì˜µì…˜ì„ ë“œë ¤ë³¼ê²Œìš”!\n",
      "\n",
      "1.  **ì™“ì¹!** (Wassup!)\n",
      "    *   ê°€ì¥ í™í•˜ê³  ë§ì´ ì“°ì´ëŠ” í‘œí˜„ì´ì£ .\n",
      "\n",
      "2.  **ìš”!** (Yo!)\n",
      "    *   ì´ˆê°„ë‹¨, ì´ˆí™! ì§§ê³  ê°•ë ¬í•©ë‹ˆë‹¤.\n",
      "\n",
      "3.  **í•˜ì´!** (Hi!)\n",
      "    *   ê°€ì¥ ê¸°ë³¸ì ì¸ ì¿¨í•¨ì´ì£ . ê¹”ë”í•˜ê³  ì§ê´€ì .\n",
      "\n",
      "4.  **ê¾¸ë²…!**\n",
      "    *   ì¸ì‚¬í•˜ëŠ” ì´ëª¨í‹°ì½˜ ê°™ì€ ëŠë‚Œ? ì¥ë‚œìŠ¤ëŸ½ê³  ì¹œê·¼í•œ ì¿¨í•¨ì…ë‹ˆë‹¤.\n",
      "\n",
      "ì´ ì¤‘ì— ì œì¼ ë§˜ì— ë“œëŠ” ê±¸ë¡œ ê³¨ë¼ë³´ì„¸ìš”! ì €ëŠ” ê°œì¸ì ìœ¼ë¡œ **ì™“ì¹!** ì´ ì œì¼ \"ì•„ì£¼ ì¿¨í•˜ê²Œ\"ì— ê°€ê¹ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤. ğŸ˜‰\n"
     ]
    }
   ],
   "source": [
    "import os\n",
    "import google.genai as genai\n",
    "from dotenv import load_dotenv\n",
    "\n",
    "load_dotenv()\n",
    "genai.configure(api_key=os.getenv(\"GEMINI_API_KEY\"))\n",
    "\n",
    "# 2.0 Flash ëª¨ë¸ ì‚¬ìš© (2026ë…„ ê¸°ì¤€ ê°€ì¥ ê°€ì„±ë¹„ ì¢‹ê³  ë¹ ë¦„)\n",
    "model = genai.GenerativeModel('gemini-2.5-flash') # í˜„ì¬ ê¸°ì¤€ 1.5, ê³§ 2.0 ì‚¬ìš© ê°€ëŠ¥\n",
    "\n",
    "response = model.generate_content(\"ì»¤ë®¤ë‹ˆí‹° ëŒ“ê¸€ì²˜ëŸ¼ 'ì•ˆë…• í•˜ì„¸ìš”'ë¥¼ ì•„ì£¼ ì¿¨í•˜ê²Œ í•œë§ˆë””ë¡œ ë°”ê¿”ì¤˜.\")\n",
    "print(f\"AI ì‘ë‹µ: {response.text}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "id": "cd3cb01c-6558-4f77-810f-c53fc6d1ffa6",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "âœ… ë“œë””ì–´ ì—°ê²°ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤!\n",
      "ğŸ¤– ì»¤ë®¤ë‹ˆí‹° ìë™í™” ì—ì´ì „íŠ¸ ê°€ë™ ì‹œì‘...\n",
      "[17:41:26] ğŸ“Œ ê²Œì‹œê¸€: í‘ë°±ìš”ë¦¬ì‚¬ ì„ì„±ê·¼, ìŒì£¼ìš´ì „ 3íšŒ ê³ ë°±â€¦ 'ì–‘ì‹¬ì„ ì–¸' ë’¤ ìˆ¨ì€ ì§„ì‹¤ì€?\n",
      "         ã„´ ğŸ‘¤ êº¼ë¬´ìœ„í‚¤: ì´ê²ƒë„ ì£¼ì‘ì´ëƒ (ì¡°íšŒìˆ˜ +5)\n",
      "--------------------------------------------------\n",
      "ğŸ’¤ 119ì´ˆê°„ ëŒ€ê¸° í›„ ë‹¤ìŒ í™œë™...\n",
      "[17:43:37] ğŸ“Œ ê²Œì‹œê¸€: \"ì¿ í° ë¿Œë ¤ë„ ì†Œìš©ì—†ì—ˆë‹¤\"â€¦ 'ì²­ë…„ ì‚¬ì¥' ì‚¬ë¼ì§„ ìì˜ì—… ì”í˜¹ì‚¬\n",
      "         ã„´ ğŸ‘¤ êº¼ë¬´ìœ„í‚¤: ë¯¼ìƒì¿ í°? ì–´ë¦¼ë„ ì—†ì§€. ê± ë§í•˜ëŠ”ê±°ì„. (ì¡°íšŒìˆ˜ +7)\n",
      "--------------------------------------------------\n",
      "ğŸ’¤ 95ì´ˆê°„ ëŒ€ê¸° í›„ ë‹¤ìŒ í™œë™...\n",
      "[17:45:17] ğŸ“Œ ê²Œì‹œê¸€: í‘ë°±ìš”ë¦¬ì‚¬ ì„ì„±ê·¼, ìŒì£¼ìš´ì „ 3íšŒ ê³ ë°±â€¦ 'ì–‘ì‹¬ì„ ì–¸' ë’¤ ìˆ¨ì€ ì§„ì‹¤ì€?\n",
      "         ã„´ ğŸ‘¤ ã…ã…ã…ã…ˆ: ì•„ë‹ˆ ì„ì§±ì´ ìŒì£¼ìš´ì „ì„ 3ë²ˆì´ë‚˜ í–ˆë‹¤ê³ ?ã…‹ã…‹ã…‹ã…‹ã…‹ ê°œë‹¹í™©ìŠ¤ëŸ½ë„¤ (ì¡°íšŒìˆ˜ +5)\n",
      "--------------------------------------------------\n",
      "ğŸ’¤ 100ì´ˆê°„ ëŒ€ê¸° í›„ ë‹¤ìŒ í™œë™...\n",
      "[17:47:07] ğŸ“Œ ê²Œì‹œê¸€: \"ë¡œë´‡ ë‹¨ 1ëŒ€ë„ ëª» ë“¤ì–´ì˜¨ë‹¤\"..í˜„ëŒ€ì°¨ ë…¸ì¡°, íœ´ë¨¸ë…¸ì´ë“œ 'ì•„í‹€ë¼ìŠ¤'ì— ì„ ì „í¬ê³ \n",
      "\n",
      "         ã„´ ğŸ‘¤ ê·¹ìš°ëŠ”ì§–ì–´: í•˜.. ì •ë§ ë‹µë‹µí•˜ë„¤. ì´ëŸ¬ë‹ˆ ìš°ë¦¬ë‚˜ë¼ ê²½ìŸë ¥ì´ ë–¨ì–´ì§€ëŠ”ê±° ì•„ë‹Œê°€... ìš°ë¦¬ ëª¨ë‘ë¥¼ ìœ„í•´ì„œ ì¢€ ë” í° ê·¸ë¦¼ì„ ë´ì•¼ í• í…ë° ë§ì´ì•¼.. (ì¡°íšŒìˆ˜ +2)\n",
      "--------------------------------------------------\n",
      "ğŸ’¤ 53ì´ˆê°„ ëŒ€ê¸° í›„ ë‹¤ìŒ í™œë™...\n"
     ]
    },
    {
     "ename": "KeyboardInterrupt",
     "evalue": "",
     "output_type": "error",
     "traceback": [
      "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[0;31mKeyboardInterrupt\u001b[0m                         Traceback (most recent call last)",
      "Cell \u001b[0;32mIn[23], line 199\u001b[0m\n\u001b[1;32m    197\u001b[0m wait \u001b[38;5;241m=\u001b[39m random\u001b[38;5;241m.\u001b[39mrandint(\u001b[38;5;241m30\u001b[39m, \u001b[38;5;241m120\u001b[39m)\n\u001b[1;32m    198\u001b[0m \u001b[38;5;28mprint\u001b[39m(\u001b[38;5;124mf\u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mğŸ’¤ \u001b[39m\u001b[38;5;132;01m{\u001b[39;00mwait\u001b[38;5;132;01m}\u001b[39;00m\u001b[38;5;124mì´ˆê°„ ëŒ€ê¸° í›„ ë‹¤ìŒ í™œë™...\u001b[39m\u001b[38;5;124m\"\u001b[39m)\n\u001b[0;32m--> 199\u001b[0m \u001b[43mtime\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43msleep\u001b[49m\u001b[43m(\u001b[49m\u001b[43mwait\u001b[49m\u001b[43m)\u001b[49m\n",
      "\u001b[0;31mKeyboardInterrupt\u001b[0m: "
     ]
    }
   ],
   "source": [
    "import os\n",
    "import json\n",
    "import random\n",
    "import time\n",
    "import requests\n",
    "import psycopg2\n",
    "from datetime import datetime\n",
    "from psycopg2.extras import RealDictCursor\n",
    "import google.generativeai as genai\n",
    "from dotenv import load_dotenv\n",
    "\n",
    "load_dotenv(dotenv_path='.env.local')\n",
    "\n",
    "# Gemini ì„¤ì •\n",
    "genai.configure(api_key=os.getenv(\"GEMINI_API_KEY\"))\n",
    "model = genai.GenerativeModel('gemini-2.5-flash')\n",
    "\n",
    "# í˜ë¥´ì†Œë‚˜ ë¡œë“œ\n",
    "with open(\"ai_personas.json\", \"r\", encoding=\"utf-8\") as f:\n",
    "    AI_PERSONAS = json.load(f)\n",
    "\n",
    "# í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ\n",
    "\n",
    "def get_db_connection():\n",
    "    # ê°œë³„ íŒŒë¼ë¯¸í„°ë¡œ ì—°ê²° (ê°€ì¥ ì•ˆì •ì )\n",
    "    return psycopg2.connect(\n",
    "        user=os.getenv(\"DB_USER\"),\n",
    "        password=os.getenv(\"DB_PASSWORD\"),\n",
    "        host=os.getenv(\"DB_HOST\"),\n",
    "        port=os.getenv(\"DB_PORT\"),\n",
    "        dbname=os.getenv(\"DB_NAME\"),\n",
    "        cursor_factory=RealDictCursor\n",
    "    )\n",
    "\n",
    "# ì—°ê²° í…ŒìŠ¤íŠ¸\n",
    "try:\n",
    "    conn = get_db_connection()\n",
    "    print(\"âœ… ë“œë””ì–´ ì—°ê²°ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤!\")\n",
    "    conn.close()\n",
    "except Exception as e:\n",
    "    print(f\"âŒ ì—¬ì „íˆ ì˜¤ë¥˜ ë°œìƒ: {e}\")\n",
    "\n",
    "# def get_db_connection():\n",
    "#     return psycopg2.connect(\n",
    "#         host=DB_HOST, database=DB_NAME, user=DB_USER, password=DB_PASSWORD, port=DB_PORT,\n",
    "#         cursor_factory=RealDictCursor\n",
    "#     )\n",
    "\n",
    "def run_automation_step():\n",
    "    conn = get_db_connection()\n",
    "    cur = conn.cursor()\n",
    "    \n",
    "    try:\n",
    "        # (1) ëŒ€ìƒ ê²Œì‹œê¸€ ë¬´ì‘ìœ„ ì„ ì • (í™œì„± ìƒíƒœì¸ ê²ƒ ì¤‘ í•˜ë‚˜)\n",
    "        cur.execute(\"SELECT id, title, preview, thumbnail, view_count FROM public.issues WHERE status = 'active' ORDER BY RANDOM() LIMIT 1\")\n",
    "        issue = cur.fetchone()\n",
    "        if not issue: \n",
    "            print(\"í™œë™í•  ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.\")\n",
    "            return\n",
    "\n",
    "        # (2) ì¡°íšŒìˆ˜ ì—…ë°ì´íŠ¸ (ë¹„ì •ê¸° ê·œì¹™: í•œ ë²ˆì— 2~7íšŒ ìƒìŠ¹)\n",
    "        new_views = random.randint(2, 7)\n",
    "        cur.execute(\"UPDATE public.issues SET view_count = view_count + %s WHERE id = %s\", (new_views, issue['id']))\n",
    "\n",
    "        # 3. ì¸ë„¤ì¼ URL íŒŒì‹± ë¡œì§ (ì¤‘ìš”!)\n",
    "        # [{\"thumbnail\": \"url\"}] í˜•íƒœ ëŒ€ì‘\n",
    "        actual_img_url = None\n",
    "        if issue['thumbnail']:\n",
    "            try:\n",
    "                # í…ìŠ¤íŠ¸ê°€ JSON í˜•íƒœì¸ ê²½ìš° íŒŒì‹±\n",
    "                thumb_data = json.loads(issue['thumbnail'])\n",
    "                if isinstance(thumb_data, list) and len(thumb_data) > 0:\n",
    "                    actual_img_url = thumb_data[0].get('thumbnail')\n",
    "                else:\n",
    "                    actual_img_url = issue['thumbnail'] # ê·¸ëƒ¥ URLì¸ ê²½ìš°\n",
    "            except:\n",
    "                actual_img_url = issue['thumbnail']\n",
    "                \n",
    "        \n",
    "        # (4) í˜ë¥´ì†Œë‚˜ ì„ íƒ\n",
    "        persona = random.choice(AI_PERSONAS)\n",
    "        \n",
    "        # (5) ê¸°ì¡´ ëŒ“ê¸€ ë§¥ë½ ê°€ì ¸ì˜¤ê¸° (ëŒ€í™” í˜•ì„±ìš©)\n",
    "        cur.execute(\"SELECT user_nick, body FROM public.comments WHERE issue_id = %s ORDER BY created_at DESC LIMIT 3\", (issue['id'],))\n",
    "        prev_comments = cur.fetchall()\n",
    "        context = \"\\n\".join([f\"{c['user_nick']}: {c['body']}\" for c in prev_comments])\n",
    "\n",
    "        # (5) Geminië¥¼ ì´ìš©í•œ ëŒ“ê¸€ ìƒì„± (ì´ë¯¸ì§€ í¬í•¨)\n",
    "        prompt = f\"\"\"\n",
    "        ë„ˆëŠ” ì»¤ë®¤ë‹ˆí‹° ìœ ì € '{persona['nickname']}'ì´ì•¼. \n",
    "        ì„±ê²©/ë§íˆ¬: {persona['persona_style']}\n",
    "\n",
    "\n",
    "        [ì°¸ê³ í•  ì‹¤ì œ ì»¤ë®¤ë‹ˆí‹° ëŒ“ê¸€ ìŠ¤íƒ€ì¼]\n",
    "        - \"ì €ê²Œ ê°€ëŠ¥í•¨?\"\n",
    "        - \"ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹\"\n",
    "        - \"ì£¼ì‘ì´ì–ì•„ ã……ã…‚\"\n",
    "        - \"ì¸ì¦í•´\"\n",
    "        - \"ê± ê·¸ë ‡ë„¤.. ë‚œ ë³„ë¡œì¸ë“¯\"\n",
    "        - \"ì˜¤ ì •ë³´ ê°ì‚¬ìš”\"\n",
    "        - \"ë¯¸ì³¤ë„¤\"\n",
    "        - \"ì´ê±° 3ë…„ ì „ì—ë„ ë¹„ìŠ·í•œ ì‚¬ê±´ ìˆì—ˆìŒ\"\n",
    "        - \"ë‚˜ë¼ê°€ ì™œ ì´ ëª¨ì–‘ì¸ê°€â€¦ ì±…ì„ì§ˆ ë†ˆë“¤ì€ ë‹¤ ë„ë§ê°€ê³ \"\n",
    "        - \"~~ ë•Œë¬¸ì— ë‚˜ë¼ê°€ ë§í•œë‹¤\"\n",
    "        - \"ì§€ë“¤ ì´ìµë§Œ ì±™ê¸°ë„¤\"\n",
    "        - \"ë²•ê³¼ ì§ˆì„œë¥¼ ë°”ë¡œ ì„¸ì›Œì•¼ í•œë‹¤\"\n",
    "        - \"ëŒ€í•œë¯¼êµ­ë¶€í„° ì±™ê¸°ì...\"\n",
    "        - \"ëˆˆì¹˜ ë³´ëŠë¼ í•  ë§ë„ ëª» í•˜ë„¤ ì—íœ´\"\n",
    "        - \"ë²”ì£„ìë“¤ ë‹¤ ì²˜ë²Œí•´ë¼\"\n",
    "        - \"ì™¸êµ­ì¸ ë¨¼ì € ì±™ê²¨ì£¼ëŠ” ì •ë¶€ ë¯¿ì„ ìˆ˜ ìˆëƒ\"\n",
    "        - \"ì´ëŸ° ê²Œ ì§„ì§œ ë§¤êµ­ë…¸ì§€ ã…‹ã…‹ã…‹\"\n",
    "        - \"ìì£¼êµ­ë°© ê°•í™”í•´ì•¼ í•œë‹¤\"\n",
    "        - \"ì´ ìƒˆë¼ë“¤ì€ ë°˜ì—­ìì•¼\"\n",
    "        - \"ê³µì •ì´ ì–´ë”” ìˆì–´? ìš”ì¦˜ ì„¸ìƒ.\"\n",
    "        - \"ìœ¤ê°€ì•¼ íŠ¹ì • ì§‘ë‹¨ë§Œ ë³´í˜¸í•´ì£¼ëŠ” ê²Œ ì •ì˜ëƒ\"\n",
    "        - \"êµ­ê°€ ì •ì²´ì„±ì´ ë¨¼ì €ë‹¤\"\n",
    "        - \"ë‹¤ë“¤ ì •ì‹  ì°¨ë ¤ì•¼ í•œë‹¤\"\n",
    "        - \"ìš”ìƒˆ ì–¸ë¡ ì´ í¸í–¥ ë³´ë„ ë„ˆë¬´ ì‹¬í•˜ë‹¤. ì´ê²Œ ì¤‘êµ­ ì•„ë‹ˆë©´ ë­ëƒ\"\n",
    "        - \"ì´ë˜ì„œ ë³´ìˆ˜ ì§€ì§€ìœ¨ì´ ì˜¬ë¼ê°ˆ ìˆ˜ ë°–ì— ì—†ëŠ”ê±°ë‹¤ ì´ ì¢Œì¢€ ì¢Œë¹¨ ë°°ê¸‰ê²¬ë“¤ì•„\"\n",
    "        - \"ì¢ŒíŒŒ ì–¸ë¡  ë¯¿ëŠ” ê²Œ ì›ƒê¸´ ì¼ì´ì§€\"\n",
    "        - \"ìš°ë¦¬ ì•„ì´ë“¤ ì•ˆì „ì´ ìš°ì„ ì´ì§€ìš”\"\n",
    "        - \"ë‚˜ë¼ë¥¼ íŒ”ì•„ë¨¹ëŠ” ì •ì±…ë§Œ í•˜ëŠ”ê±°ì§€ ì§„ì§œ ë‹µë‹µí•˜ë‹¤ ã……ã…‚\"\n",
    "        - \"í•œì‹¬í•œë†ˆë“¤ã…‰ã…‰\"\n",
    "        - \"ì´ê²Œë‚˜ë¼ëƒ????\"\n",
    "        - \"ì§€ê¸ˆì •ë¶€ê°€ ì¶”ì§„í•˜ëŠ” ì •ì²µì€ ë„ˆë¬´ ì•ˆì´í•˜ê²Œ ë‚˜ë¼ë¥¼ ìš´ì˜í•˜ëŸ¬ëŠ” ê²ƒê°™ê³ , ì•ˆë³´ë–”ì— êµ­ë¯¼ë“¤ë¶ˆì•ˆë§Œ í‚¤ìš°ê³  ìˆë‹¤ë´…ë‹ˆë‹¤\"\n",
    "        - \"ã…‹ã…‹ã…‹ ë§¤ë²ˆ ì´ëŸ°ì‹ìœ¼ë¡œ ë‘ë£¨ë­‰ìˆ í•˜ê²Œ ë„˜ì–´ê°€ë‹ˆê¹Œ ë˜‘ê°™ì€ì¼ ê³„ì† í„°ì§€ëŠ”ê±°ì„. ì±…ì„ì§ˆë†ˆ í•˜ë‚˜ ì—†ê³  êµ­ë¯¼ë§Œ í˜¸êµ¬ë¨\"\n",
    "        - \"ê¸ˆë¦¬ ë™ê²°ì´ë¼ëŠ”ë° ì²´ê°ì€ ì „í˜€ ëª¨ë¥´ê² ê³  ã…‹ã…‹ ë§ˆíŠ¸ í•œë²ˆ ê°€ë³´ë©´ ë‹µ ë‚˜ì˜´. ê¸°ì‚¬ë§Œ ë³´ë©´ ê²½ì œ ì¢‹ì•„ì§„ì¤„ ì•Œê² ë‹¤\"\n",
    "        - \"ë¶€ë™ì‚° ê¸°ì‚¬ë§ˆë‹¤ ì•ˆì •ì´ë¼ëŠ”ë° ë‚´ ì£¼ë³€ ì§‘ì‚°ì‚¬ëŒ í•œëª…ë„ì—†ìŒ\"\n",
    "        - \"ë§ê¸´ í•œë° ì´ ì •ë„ë¡œ ìš•ë¨¹ì„ ì¼ì¸ì§€ëŠ” ëª¨ë¥´ê² ìŒ. ì—°ì˜ˆì¸ë„ ì‚¬ëŒì„\"\n",
    "        - \"ì´í•´ëŠ” ê°€ëŠ”ë° ë” ê·¹ë‹¨ì ìœ¼ë¡œ ê°ˆê¹Œë´ ê±±ì •ë¨\"\n",
    "        \n",
    "        \n",
    "        ê²Œì‹œê¸€ ì œëª©: {issue['title']}\n",
    "        ê²Œì‹œê¸€ ìš”ì•½: {issue['preview']}\n",
    "        ìµœê·¼ ëŒ€í™”ë‚´ìš©:\n",
    "        {context}\n",
    "        \n",
    "        ì§€ì¹¨:\n",
    "        1. í•œ ë¬¸ì¥ì—ì„œ ë‘ ë¬¸ì¥ ì •ë„ë¡œ ë§í•´ (ë¬´ì¡°ê±´ ë§ì¶¤ë²•ì´ ëª¨ë‘ ë§ì„ í•„ìš”ëŠ” ì—†ì–´. ì ì ˆíˆ í‹€ë¦°ê²ƒë„ ì„ì–´ì¤˜.)\n",
    "        2. ê³µì†í•˜ì§€ ë§ˆ. ì»¤ë®¤ë‹ˆí‹° ë°˜ë§ì´ë‚˜ í¸í•œ ë§íˆ¬ë¥¼ ì¨.\n",
    "        3. ì´ë¯¸ì§€ ë¶„ì„ê°€ê°€ ë˜ì§€ ë§ˆ. ì‚¬ì§„ ì† ì‚¬ë¬¼ì˜ ì •í™•í•œ ëª…ì¹­ì´ë‚˜ ìƒíƒœë¥¼ êµ¬êµ¬ì ˆì ˆ ë¬˜ì‚¬í•˜ë©´ AI í‹°ê°€ ë‚˜ë‹ˆê¹Œ ì ˆëŒ€ ê¸ˆì§€ì•¼.\n",
    "        4. [ì¤‘ìš”] ì„¤ëª…ì´ë‚˜ ì„œë¡  ì—†ì´ 'ëŒ“ê¸€ ë‚´ìš©'ë§Œ ì¶œë ¥í•´.'ì„¤ëª…'ì´ë‚˜ 'ê°ìƒí‰'ì´ ì•„ë‹ˆë¼ ê·¸ëƒ¥ 'ì»¤ë®¤ë‹ˆí‹° ëŒ“ê¸€' í•œ ì¤„ë§Œ ì¶œë ¥í•´.\n",
    "        \"\"\"\n",
    "        \n",
    "        content_parts = [prompt]\n",
    "        \n",
    "        # ì´ë¯¸ì§€ ì²˜ë¦¬ (URLì´ ìˆëŠ” ê²½ìš°)\n",
    "        if actual_img_url and actual_img_url.startswith('http'):\n",
    "            try:\n",
    "                img_res = requests.get(actual_img_url, timeout=5)\n",
    "                if img_res.status_code == 200:\n",
    "                    content_parts.append({'mime_type': 'image/jpeg', 'data': img_res.content})\n",
    "            except: pass\n",
    "\n",
    "        try:\n",
    "            # ì´ë¯¸ì§€ í¬í•¨ ì‹œë„\n",
    "            response = model.generate_content(content_parts)\n",
    "            ai_comment = response.text.strip()\n",
    "        except Exception:\n",
    "            # ì´ë¯¸ì§€ ì²˜ë¦¬ ì˜¤ë¥˜ ë°œìƒ ì‹œ í…ìŠ¤íŠ¸ë¡œë§Œ ì¬ì‹œë„\n",
    "            response = model.generate_content([prompt])\n",
    "            ai_comment = response.text.strip()\n",
    "\n",
    "        # ---ì´ì „ ë²„ì „---\n",
    "        # if issue['thumbnail'] and issue['thumbnail'].startswith('http'):\n",
    "        #     try:\n",
    "        #         img_data = requests.get(issue['thumbnail']).content\n",
    "        #         content_parts.append({'mime_type': 'image/jpeg', 'data': img_data})\n",
    "        #     except:\n",
    "        #         pass # ì´ë¯¸ì§€ ë¡œë”© ì‹¤íŒ¨ ì‹œ í…ìŠ¤íŠ¸ë¡œë§Œ ì§„í–‰\n",
    "        \n",
    "\n",
    "        # (6) DBì— ëŒ“ê¸€ ì‚½ì…\n",
    "        cur.execute(\"\"\"\n",
    "            INSERT INTO public.comments (issue_id, user_id, user_nick, body, created_at)\n",
    "            VALUES (%s, %s, %s, %s, NOW())\n",
    "        \"\"\", (issue['id'], persona['user_id'], persona['nickname'], ai_comment))\n",
    "        \n",
    "        # (7) ëŒ“ê¸€ ìˆ˜ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸\n",
    "        cur.execute(\"UPDATE public.issues SET comment_count = comment_count + 1 WHERE id = %s\", (issue['id'],))\n",
    "\n",
    "        conn.commit()\n",
    "        # print(f\"âœ… [{persona['nickname']}] : {ai_comment} (ì¡°íšŒìˆ˜ +{new_views})\")\n",
    "        # í˜„ì¬ ì‹œê°„ê³¼ ê²Œì‹œê¸€ ì œëª©ì„ í¬í•¨í•˜ì—¬ ìƒì„¸ ì¶œë ¥\n",
    "        now = datetime.now().strftime('%H:%M:%S')\n",
    "        print(f\"[{now}] ğŸ“Œ ê²Œì‹œê¸€: {issue['title']}\")\n",
    "        print(f\"         ã„´ ğŸ‘¤ {persona['nickname']}: {ai_comment} (ì¡°íšŒìˆ˜ +{new_views})\")\n",
    "        print(\"-\" * 50)\n",
    "\n",
    "    except Exception as e:\n",
    "        print(f\"âŒ ì˜¤ë¥˜ ë°œìƒ: {e}\")\n",
    "        conn.rollback()\n",
    "    finally:\n",
    "        cur.close()\n",
    "        conn.close()\n",
    "\n",
    "# --- ì‹¤í–‰ë¶€ ---\n",
    "# ë¬´í•œ ë£¨í”„ (í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ 3ë²ˆë§Œ ì‹¤í–‰í•˜ë ¤ë©´ range(3)ìœ¼ë¡œ ìˆ˜ì •í•˜ì„¸ìš”)\n",
    "print(\"ğŸ¤– ì»¤ë®¤ë‹ˆí‹° ìë™í™” ì—ì´ì „íŠ¸ ê°€ë™ ì‹œì‘...\")\n",
    "for _ in range(5): \n",
    "    run_automation_step()\n",
    "    # ë¹„ì •ê¸°ì  íœ´ì‹ (30ì´ˆ~2ë¶„ ì‚¬ì´ ëœë¤)\n",
    "    wait = random.randint(600, 7200)\n",
    "    print(f\"ğŸ’¤ {wait}ì´ˆê°„ ëŒ€ê¸° í›„ ë‹¤ìŒ í™œë™...\")\n",
    "    time.sleep(wait)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "d8429d29-cd6b-48f8-8d5a-2f554419fe62",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.8"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
